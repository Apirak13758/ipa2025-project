<!DOCTYPE html>
<html>

<head>
    <title>Router Detail</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/style.css" />
</head>

<body>
    {% include 'navbar.html' %}
    <div class="container mt-5">
        <div class="row mb-4">
            <div class="col">
                <h1 class="fw-bold">Router: {{ ip }}</h1>
                <a href="{{ url_for('main') }}" class="btn btn-secondary">Back to Main</a>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col">
                <div class="card">
                    <div class="card-body">
                        <h2 class="card-title">Recent Interface Status</h2>
                        <form method="POST" action="/update_config/{{ ip }}">
                            <table class="table table-bordered table-hover mb-4">
                                <thead class="table-light">
                                    <tr>
                                        <th>Timestamp</th>
                                        <th>Interface</th>
                                        <th>IP Address</th>
                                        <th>Status</th>
                                        <th>Protocol</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for entry in status %}
                                    {% for iface in entry.data['show ip interface brief'] %}
                                    {% set iface_name = iface.INTERFACE %}
                                    <tr>
                                        <td>{{ entry.timestamp }}</td>

                                        <!-- Interface name -->
                                        <td>
                                            {% if iface_name == "GigabitEthernet0/0" %}
                                            <input type="text" class="form-control bg-light text-muted border-0"
                                                value="{{ iface_name }}" readonly style="cursor: not-allowed;">
                                            {% else %}
                                            <input type="text" name="interfaces[{{ loop.index0 }}][name]"
                                                class="form-control" value="{{ iface_name }}">
                                            {% endif %}
                                        </td>

                                        <!-- IP Address -->
                                        <td>
                                            {% if iface_name == "GigabitEthernet0/0" %}
                                            <input type="text" class="form-control bg-light text-muted border-0"
                                                value="{{ iface.IP_ADDRESS }}" readonly style="cursor: not-allowed;">
                                            {% else %}
                                            <input type="text" name="interfaces[{{ loop.index0 }}][ip]"
                                                class="form-control" value="{{ iface.IP_ADDRESS }}">
                                            {% endif %}
                                        </td>

                                        <!-- Status -->
                                        <td>
                                            {% if iface_name == "GigabitEthernet0/0" %}
                                            <input type="text" class="form-control bg-light text-muted border-0"
                                                value="{{ iface.STATUS }}" readonly style="cursor: not-allowed;">
                                            {% else %}
                                            <input type="text" name="interfaces[{{ loop.index0 }}][status]"
                                                class="form-control" value="{{ iface.STATUS }}">
                                            {% endif %}
                                        </td>

                                        <!-- Protocol -->
                                        <td>
                                            {% if iface_name == "GigabitEthernet0/0" %}
                                            <input type="text" class="form-control bg-light text-muted border-0"
                                                value="{{ iface.PROTOCOL }}" readonly style="cursor: not-allowed;">
                                            {% else %}
                                            <input type="text" name="interfaces[{{ loop.index0 }}][protocol]"
                                                class="form-control" value="{{ iface.PROTOCOL }}">
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                    {% endfor %}
                                </tbody>
                            </table>

                            <div class="text-end">
                                <button type="submit" class="btn btn-warning">Save Changes</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-md-6">
                <h2>Show Version</h2>
                <table class="table table-bordered">
                    <thead class="table-light">
                        <tr>
                            <th>Hostname</th>
                            <th>Version</th>
                            <th>Uptime</th>
                            <th>Image</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for entry in status %}
                        {% for ver in entry.data['show version'] %}
                        <tr>
                            <td>{{ ver.HOSTNAME }}</td>
                            <td>{{ ver.VERSION }}</td>
                            <td>{{ ver.UPTIME }}</td>
                            <td>{{ ver.IMAGE }}</td>
                        </tr>
                        {% endfor %}
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <div class="col-md-6">
                <h2>Show IP Route</h2>
                <table class="table table-bordered">
                    <thead class="table-light">
                        <tr>
                            <th>Timestamp</th>
                            <th>Network</th>
                            <th>Mask</th>
                            <th>Next Hop</th>
                            <th>Interface</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for entry in status %}
                        {% for route in entry.data['show ip route'] %}
                        <tr>
                            <td>{{ entry.timestamp }}</td>
                            <td>{{ route.NETWORK }}</td>
                            <td>{{ route.MASK }}</td>
                            <td>{{ route.NEXT_HOP }}</td>
                            <td>{{ route.INTERFACE }}</td>
                        </tr>
                        {% endfor %}
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>